var mediaLibraryOrganizerTreeViewGridSelectedAttachments,mediaLibraryOrganizerTreeViewGridModified;function mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(e,r){(function(i){if(!e){return}if(!r){return}i.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.actions.categorize_attachments.action,nonce:media_library_organizer_tree_view.actions.categorize_attachments.nonce,taxonomy_name:media_library_organizer_tree_view.taxonomy.name,attachment_ids:e,term_id:r},function(e){if(!e.success){wpzinc_notification_show_error_message(e.data);return}wpzinc_notification_show_success_message(media_library_organizer_tree_view.labels.categorized_attachments.replace("%s",e.data.attachments.length));var r=e.data;r.selected_term=media_library_organizer_tree_view.selected_term;r.media_view=media_library_organizer_tree_view.media_view;wp.media.events.trigger("mlo:grid:tree-view:assigned:attachments:term",r)})})(jQuery)}function mediaLibraryOrganizerTreeViewGet(e,r){(function(i){i.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.actions.get_tree_view.action,nonce:media_library_organizer_tree_view.actions.get_tree_view.nonce,taxonomy_name:e,current_term:r},function(e){if(!e.success){return false}mediaLibraryOrganizerTreeViewDestroyJsTree();const r=new CustomEvent("mlo:tree-view:updated",{detail:e});window.dispatchEvent(r);mediaLibraryOrganizerTreeViewInitJsTree();mediaLibraryOrganizerTreeViewInitDroppable();wp.media.events.trigger("mlo:grid:tree-view:loaded")})})(jQuery)}function mediaLibraryOrganizerTreeViewInitJsTree(){(function(e){if(e(".media-library-organizer-tree-view-enabled").length){e("li.current-cat-ancestor",e(".media-library-organizer-tree-view-enabled")).each(function(){e(this).addClass("jstree-open")});e(".media-library-organizer-tree-view-enabled").jstree().bind("select_node.jstree",function(e,r){document.location.href=r.node.a_attr.href}).bind("open_node.jstree",function(e,r){mediaLibraryOrganizerTreeViewInitDroppable()})}})(jQuery)}function mediaLibraryOrganizerTreeViewDestroyJsTree(){(function(e){if(e(".media-library-organizer-tree-view-enabled").length){e(".media-library-organizer-tree-view-enabled").jstree("destroy")}})(jQuery)}function mediaLibraryOrganizerTreeViewListInitDraggable(){(function(e){e("td.title.column-title strong.has-media-icon, td.tree-view-move span.dashicons-move").draggable({appendTo:"body",revert:true,cursorAt:{top:10,left:10},helper:function(){var r=e(this).closest("tr").attr("id").split("-")[1],i=[r];if(e("table.media tbody input:checked").length>0){e("table.media tbody input:checked").each(function(){if(e(this).val()==r){return}i.push(e(this).val())})}var a="";if(i.length>1){a=media_library_organizer_tree_view.labels.categorize_attachments.replace("%s",i.length)}else{a=media_library_organizer_tree_view.labels.categorize_attachment}return e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+a+"</div>")}})})(jQuery)}function mediaLibraryOrganizerTreeViewGridInitDraggable(){(function(e){e("li.attachment").draggable({appendTo:"body",revert:true,cursorAt:{top:40,left:10},helper:function(){var r=e(this).data("id"),i=[r];if(mediaLibraryOrganizerTreeViewGridSelectedAttachments.length>0){var a=mediaLibraryOrganizerTreeViewGridSelectedAttachments.length;for(var t=0;t<a;t++){if(mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[t].id==r){continue}i.push(mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[t].id)}}var n="";if(i.length>1){n=media_library_organizer_tree_view.labels.categorize_attachments.replace("%s",i.length)}else{n=media_library_organizer_tree_view.labels.categorize_attachment}return e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+n+"</div>")}})})(jQuery)}function mediaLibraryOrganizerTreeViewInitDroppable(){(function(e){e("#media-library-organizer-tree-view-list .cat-item, #media-library-organizer-tree-view-list .cat-item-unassigned").droppable({hoverClass:"media-library-organizer-tree-view-droppable-hover",drop:function(r,i){var a=e(i.helper).data("attachment-ids");if(a.toString().search(",")){a=a.toString().split(",")}var t=mediaLibraryOrganizerTreeViewGetTermIDFromElement(e(r.target));mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(a,t)}})})(jQuery)}function mediaLibraryOrganizerTreeViewGetTermIDFromElement(e){if(typeof e[0]==="undefined"){return false}if(typeof e[0].className==="undefined"){return false}var r=e[0].className.split(" "),i=r.length;for(var a=0;a<i;a++){if(r[a].search("cat-item-")==-1){continue}var t=r[a].replace("cat-item-","");if(t=="unassigned"){return-1}return t}return false}function mediaLibraryOrganizerTreeViewGetTermNameFromElement(e){return jQuery(e).contents().filter(function(){return this.nodeType==3})[0].nodeValue.trim()}if(media_library_organizer_tree_view.media_view=="grid"){jQuery(document).ready(function(e){var r=new MutationObserver(mediaLibraryOrganizerTreeViewGridInitDraggable);r.observe(document.querySelector(".attachments-browser ul.attachments"),{childList:true})});(function(e,r){r.extend(wp.media.view.AttachmentFilters.prototype,{select:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.controller.state().get("selection")}});r.extend(wp.media.controller.Library.prototype,{refreshContent:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.get("selection")}})})(jQuery,_)}jQuery(document).ready(function(e){if(e("body").hasClass("upload-php")){e(".wrap").wrap('<div class="media-library-organizer-tree-view"></div>');e(".media-library-organizer-tree-view").prepend(e("#media-library-organizer-tree-view"));e("#media-library-organizer-tree-view").show();var r=new StickySidebar("#media-library-organizer-tree-view",{containerSelector:".media-library-organizer-tree-view",innerWrapperSelector:".media-library-organizer-tree-view-inner"});mediaLibraryOrganizerTreeViewInitJsTree();mediaLibraryOrganizerTreeViewListInitDraggable();const i=new MutationObserver(mediaLibraryOrganizerTreeViewInitDroppable);i.observe(document.querySelector("#media-library-organizer-tree-view"),{childList:true,subtree:true})}});wp.media.events.on("mlo:grid:tree-view:added:term",function(e){(function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term);break;case"grid":if(!MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")){mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)}break}})(jQuery)});wp.media.events.on("mlo:grid:tree-view:edited:term",function(e){(function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term);mediaLibraryOrganizerListViewUpdateAttachmentTerms(e.taxonomy.name,e.old_term,e.term);break;case"grid":if(!MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")){mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)}if(typeof wp.media.frame.library!=="undefined"){wp.media.frame.library.props.set({ignore:+new Date})}else{wp.media.frame.content.get().collection.props.set({ignore:+new Date});wp.media.frame.content.get().options.selection.reset()}break}})(jQuery)});wp.media.events.on("mlo:grid:tree-view:deleted:term",function(e){(function(r){switch(e.media_view){case"list":if(e.selected_term==e.term.slug){window.location.href="upload.php?mode=list";return}mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term);mediaLibraryOrganizerListViewUpdateAttachmentTerms(e.taxonomy.name,e.term,false);break;case"grid":if(e.selected_term==e.term.slug){window.location.href="upload.php?mode=grid";return}if(!MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")){mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)}if(typeof wp.media.frame.library!=="undefined"){wp.media.frame.library.props.set({ignore:+new Date})}else{wp.media.frame.content.get().collection.props.set({ignore:+new Date});wp.media.frame.content.get().options.selection.reset()}break}})(jQuery)});wp.media.events.on("mlo:grid:tree-view:assigned:attachments:term",function(e){(function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,media_library_organizer_tree_view.selected_term);for(let t in e.attachments){var i=[],a=e.attachments[t].terms.length;for(j=0;j<a;j++){i.push('<a href="upload.php?taxonomy='+e.attachments[t].terms[j].taxonomy+"&term="+e.attachments[t].terms[j].slug+'">'+e.attachments[t].terms[j].name+"</a>")}r("tr#post-"+e.attachments[t].id+" td.taxonomy-"+e.taxonomy.name).html(i.join(", "))}break;case"grid":if(MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")){MediaLibraryOrganizerAttachmentsBrowser.controller.deactivateMode("select").activateMode("edit")}mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned);mediaLibraryOrganizerGridViewRefresh();break}if(e.taxonomy.name!=media_library_organizer_tree_view.taxonomy.name){return}mediaLibraryOrganizerTreeViewGet(e.taxonomy.name,e.selected_term)})(jQuery)});wp.media.events.on("mlo:grid:edit-attachment:added:term",function(e){if(e.taxonomy.name!=media_library_organizer_tree_view.taxonomy.name){return}mediaLibraryOrganizerTreeViewGet(e.taxonomy.name,media_library_organizer_tree_view.selected_term)});wp.media.events.on("mlo:grid:edit-attachment:edited",function(e){(function(r){if(!e.taxonomy_term_changed){return}mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)})(jQuery)});wp.media.events.on("mlo:grid:filter:change:term",function(e){if(e.taxonomy_name!=media_library_organizer_tree_view.taxonomy.name){return}media_library_organizer_tree_view.selected_term=e.slug;mediaLibraryOrganizerTreeViewGet(e.taxonomy_name,e.slug)});wp.media.events.on("mlo:grid:attachment:upload:success",function(e){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)});wp.media.events.on("mlo:grid:edit-attachment:deleted",function(e){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)});wp.media.events.on("mlo:grid:attachments:bulk_actions:done",function(){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)});