var mediaLibraryOrganizerUploader=false,MediaLibraryOrganizerTaxonomyFilter={},MediaLibraryOrganizerTaxonomyOrderBy,MediaLibraryOrganizerTaxonomyOrder,MediaLibraryOrganizerAttachmentsBrowser;function mediaLibraryOrganizerQueryInitialize(){(function(){wp.media.query=function(e){return new wp.media.model.Attachments(null,{props:_.extend(_.defaults(e||{},{orderby:media_library_organizer_media.defaults.orderby,order:media_library_organizer_media.defaults.order}),{query:true})})};var e=wp.media.model.Query;_.extend(e,{get:function(){var r=[];return function(i,a){var t={},n=e.orderby,o=e.defaultProps,d,m=false;delete i.query;delete i.cache;_.defaults(i,o);i.order=i.order.toUpperCase();if("DESC"!==i.order&&"ASC"!==i.order){i.order=o.order.toUpperCase()}if(!_.contains(n.allowed,i.orderby)){i.orderby=o.orderby}_.each(["include","exclude"],function(e){if(i[e]&&!_.isArray(i[e])){i[e]=[i[e]]}});_.each(i,function(r,i){if(_.isNull(r)){return}t[e.propmap[i]||i]=r});_.defaults(t,e.defaultArgs);t.orderby=n.valuemap[i.orderby]||i.orderby;m=false;if(m){d=_.find(r,function(e){return _.isEqual(e.args,t)})}else{r=[]}if(!d){d=new e([],_.extend(a||{},{props:i,args:t}));r.push(d)}wp.media.events.trigger("mlo:grid:query",{query:d});return d}}()})})(jQuery,_)}function mediaLibraryOrganizerUploaderInitializeEvents(){(function(e,r){if(typeof wp.Uploader!=="undefined"){r.extend(wp.Uploader.prototype,{init:function(){wp.media.events.trigger("mlo:grid:attachment:upload:init")},added:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:added",e)},progress:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:progress",e)},success:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:success",e)},error:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:error",e)},complete:function(){wp.media.events.trigger("mlo:grid:attachment:upload:complete")},refresh:function(){wp.media.events.trigger("mlo:grid:attachment:upload:refresh")}})}})(jQuery,_)}function mediaLibraryOrganizerGridViewInitializeTaxonomyFilters(){(function(){for(let e in media_library_organizer_media.taxonomies){mediaLibraryOrganizerGridViewInitializeTaxonomyFilter(e,media_library_organizer_media.taxonomies[e].terms,media_library_organizer_media.taxonomies[e].taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned,media_library_organizer_media.show_attachment_count)}})(jQuery,_)}function mediaLibraryOrganizerGridViewInitializeTaxonomyFilter(e,r,i,a,t){(function(){if(media_library_organizer_media.settings[e+"_enabled"]=="0"||!media_library_organizer_media.settings[e+"_enabled"]){return}MediaLibraryOrganizerTaxonomyFilter[e]=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter-"+e,createFilters:function(){var n={};_.each(r||{},function(r,i){var a={};a[e]=r.slug;var o=r.name+(t==="1"?" ("+r.count+")":"");n[i]={text:o,props:a}});var o={};o[e]="";n.all={text:i,props:o,priority:10};var o={};o[e]="-1";n.unassigned={text:a,props:o,priority:10};this.filters=n},change:function(){var r=this.filters[this.el.value];if(r){this.model.set(r.props);wp.media.events.trigger("mlo:grid:filter:change:term",{taxonomy_name:e,slug:r.props[e]})}},select:function(){var e=this.model,r="all",i=e.toJSON();wp.media.events.trigger("mlo:grid:filter:select",{props:i});_.find(this.filters,function(e,a){var t=_.all(e.props,function(e,r){return e===(_.isUndefined(i[r])?null:i[r])});if(t){return r=a}});this.$el.val(r)}})})(jQuery,_)}function mediaLibraryOrganizerGridViewInitializeOrderByFilter(){(function(){if(media_library_organizer_media.settings.orderby_enabled==1){MediaLibraryOrganizerTaxonomyOrderBy=wp.media.view.AttachmentFilters.extend({id:"media-attachment-orderby",createFilters:function(){var e={};_.each(media_library_organizer_media.orderby||{},function(r,i){e[i]={text:r,props:{orderby:i}}});this.filters=e},select:function(){var e=this.model,r="all",i=e.toJSON();_.find(this.filters,function(e,a){var t=_.all(e.props,function(e,r){return e===(_.isUndefined(i[r])?null:i[r])});if(t){return r=a}});this.$el.val(r)}})}})(jQuery,_)}function mediaLibraryOrganizerGridViewInitializeOrderFilter(){(function(){if(media_library_organizer_media.settings.order_enabled==1){MediaLibraryOrganizerTaxonomyOrder=wp.media.view.AttachmentFilters.extend({id:"media-attachment-order",createFilters:function(){var e={};_.each(media_library_organizer_media.order||{},function(r,i){e[i]={text:r,props:{order:i}}});this.filters=e},select:function(){var e=this.model,r="all",i=e.toJSON();_.find(this.filters,function(e,a){var t=_.all(e.props,function(e,r){return e===(_.isUndefined(i[r])?null:i[r])});if(t){return r=a}});this.$el.val(r)}})}})(jQuery,_)}function mediaLibraryOrganizerGridViewAddFiltersToToolbar(){(function(){var e=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){e.prototype.createToolbar.call(this);if(!this.options.search){return}var r=-75;for(let e in MediaLibraryOrganizerTaxonomyFilter){this.toolbar.set(e,new MediaLibraryOrganizerTaxonomyFilter[e]({controller:this.controller,model:this.collection.props,priority:r}).render());r++}if(media_library_organizer_media.settings.orderby_enabled==1){this.toolbar.set("MediaLibraryOrganizerTaxonomyOrderBy",new MediaLibraryOrganizerTaxonomyOrderBy({controller:this.controller,model:this.collection.props,priority:r}).render());r++}if(media_library_organizer_media.settings.order_enabled==1){this.toolbar.set("MediaLibraryOrganizerTaxonomyOrder",new MediaLibraryOrganizerTaxonomyOrder({controller:this.controller,model:this.collection.props,priority:r}).render());r++}wp.media.events.trigger("mlo:grid:filters:add",{attachments_browser:this,priority:r});this.controller.on("select:activate",function(){wp.media.events.trigger("mlo:grid:bulk_select:enabled")});this.controller.on("select:deactivate",function(){wp.media.events.trigger("mlo:grid:bulk_select:disabled")});this.controller.on("selection:action:done",function(){wp.media.events.trigger("mlo:grid:attachments:bulk_actions:done")});MediaLibraryOrganizerAttachmentsBrowser=this},createAttachmentsHeading:function(){e.prototype.createAttachmentsHeading.call(this)},createAttachmentsWrapperView:function(){e.prototype.createAttachmentsWrapperView.call(this);setTimeout(function(){MediaLibraryOrganizerAttachmentsBrowser.attachmentsWrapper.el.style.top=MediaLibraryOrganizerAttachmentsBrowser.toolbar.el.clientHeight+10+"px"},500);window.onresize=function(){MediaLibraryOrganizerAttachmentsBrowser.attachmentsWrapper.el.style.top=MediaLibraryOrganizerAttachmentsBrowser.toolbar.el.clientHeight+10+"px"}}})})(jQuery,_)}function mediaLibraryOrganizerGridViewInitializeEditAttachmentListeners(){(function(e,r){e("body").on("click","table.compat-attachment-fields a.taxonomy-add-new",function(r){r.preventDefault();mediaLibraryOrganizerEditAttachmentToggleTaxonomyTermForm(e(this).data("taxonomy"))});e("body").on("click","table.compat-attachment-fields div.mlo-taxonomy-term-add-fields input[type=button]",function(r){r.preventDefault();mediaLibraryOrganizerEditAttachmentAddTerm(e(this).data("taxonomy"),e("input[type=text]",e(this).parent()).val())});r.extend(wp.media.view.AttachmentCompat.prototype,{render:function(){var e=this.model.get("compat");if(!e||!e.item){return}this.views.detach();this.$el.html(e.item);this.views.render();var r=this.model;setTimeout(function(){wp.media.events.trigger("mlo:grid:edit-attachment:edit",{attachment_id:r.id,attachment:r.attributes})},1e3);return this}});var i;r.extend(wp.media.view.Attachment.prototype,{updateSave:function(e){var r=this._save=this._save||{status:"ready"};if(e&&e!==r.status){this.$el.removeClass("save-"+r.status);r.status=e}this.$el.addClass("save-"+r.status);if(i=="waiting"&&(r.status=="ready"||r.status=="complete")){wp.media.events.trigger("mlo:grid:edit-attachment:edited",{attachment_id:this.model.id,attachment:this.model.attributes,changed:this.model.changed,taxonomy_term_changed:typeof this.model.changed.compat!=="undefined"?true:false})}i=r.status;return this}});r.extend(wp.media.view.Attachment.Details.prototype,{moveFocus:function(){wp.media.events.trigger("mlo:grid:edit-attachment:deleted");if(this.previousAttachment.length){this.previousAttachment.focus();return}if(this.nextAttachment.length){this.nextAttachment.focus();return}if(this.controller.uploader&&this.controller.uploader.$browser){this.controller.uploader.$browser.focus();return}this.moveFocusToLastFallback()}})})(jQuery,_)}function mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e,r,i,a,t){(function(n){if(!MediaLibraryOrganizerTaxonomyFilter.hasOwnProperty(e)){return}mediaLibraryOrganizerGridViewInitializeTaxonomyFilter(e,r,i,a,t);MediaLibraryOrganizerAttachmentsBrowser.toolbar.set(e,new MediaLibraryOrganizerTaxonomyFilter[e]({controller:MediaLibraryOrganizerAttachmentsBrowser.controller,model:MediaLibraryOrganizerAttachmentsBrowser.collection.props,priority:-75}).render())})(jQuery)}function mediaLibraryOrganizerGridViewUpdateTaxonomyFilters(){(function(e){e.post(media_library_organizer_media.ajaxurl,{action:media_library_organizer_media.get_taxonomies_terms.action,nonce:media_library_organizer_media.get_taxonomies_terms.nonce},function(e){if(!e.success){alert(e.data);return}for(let r in e.data){mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.data[r].taxonomy.name,e.data[r].terms,e.data[r].taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)}})})(jQuery)}function mediaLibraryOrganizerGridViewUpdateTaxonomyFilter(e){(function(r){r.post(media_library_organizer_media.ajaxurl,{action:media_library_organizer_media.get_taxonomy_terms.action,nonce:media_library_organizer_media.get_taxonomy_terms.nonce,taxonomy_name:e},function(e){if(!e.success){alert(e.data);return}mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.data.taxonomy.name,e.data.terms,e.data.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)})})(jQuery)}function mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e,r,i){(function(a){a("select#"+e).replaceWith(r);if(i.length>0){a("select#"+e).val(i)}})(jQuery)}function mediaLibraryOrganizerListViewUpdateAttachmentTerms(e,r,i){(function(a){a("td.taxonomy-"+e+" a").each(function(){if(a(this).text()==r.name){if(!i){a(this).remove()}else{a(this).text(i.name);a(this).attr("href","upload.php?taxonomy="+e+"&term="+i.slug)}}});a("td.taxonomy-"+e).each(function(){a(this).html(a(this).html().replace(/(^\s*,)|(,\s*$)/g,""))})})(jQuery)}function mediaLibraryOrganizerEditAttachmentToggleTaxonomyTermForm(e){(function(r){if(r(".mlo-taxonomy-term-add-fields."+e).hasClass("hidden")){r(".mlo-taxonomy-term-add-fields."+e).removeClass("hidden")}else{r(".mlo-taxonomy-term-add-fields."+e).addClass("hidden")}})(jQuery)}function mediaLibraryOrganizerEditAttachmentResetTaxonomyTermForm(e){(function(r){r(".mlo-taxonomy-term-add-fields."+e+"input[type=text]").val("")})(jQuery)}function mediaLibraryOrganizerEditAttachmentAddTerm(e,r,i){(function(a){var t={action:media_library_organizer_media.create_term.action,nonce:media_library_organizer_media.create_term.nonce,taxonomy_name:e,term_name:r,term_parent_id:i};a.post(media_library_organizer_media.ajaxurl,t,function(r){if(!r.success){alert(r.data);return}wp.media.events.trigger("mlo:grid:edit-attachment:added:term",r.data);a("ul#"+r.data.term.taxonomy+"checklist").prepend(r.data.checkbox);mediaLibraryOrganizerEditAttachmentResetTaxonomyTermForm(e);a("ul#"+r.data.term.taxonomy+'checklist li:first input[type="checkbox"]').trigger("change")})})(jQuery)}function mediaLibraryOrganizerGridViewRefresh(){if(typeof wp.media.frame.library!=="undefined"){wp.media.frame.library.props.set({ignore:+new Date})}else{wp.media.frame.content.get().collection.props.set({ignore:+new Date})}}wp.media.events.on("mlo:grid:attachment:upload:init",function(){if(!mediaLibraryOrganizerUploader&&typeof wp.media.frame.uploader!=="undefined"){mediaLibraryOrganizerUploader=wp.media.frame.uploader}if(mediaLibraryOrganizerUploader&&typeof mediaLibraryOrganizerUploader.uploader!=="undefined"){var e={};for(let r in media_library_organizer_media.taxonomies){e[r]=media_library_organizer_media.taxonomies[r].selected_term}mediaLibraryOrganizerUploader.uploader.uploader.settings.multipart_params.media_library_organizer=e}});wp.media.events.on("mlo:grid:filter:change:term",function(e){if(mediaLibraryOrganizerUploader&&typeof mediaLibraryOrganizerUploader.uploader!=="undefined"){mediaLibraryOrganizerUploader.uploader.uploader.settings.multipart_params.media_library_organizer[e.taxonomy_name]=e.slug}});wp.media.events.on("mlo:grid:attachment:upload:success",function(e){mediaLibraryOrganizerGridViewRefresh()});wp.media.events.on("mlo:grid:edit-attachment:added:term",function(e){mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items,media_library_organizer_media.labels.unassigned)});wp.media.events.on("mlo:grid:edit-attachment:edited",function(e){(function(r){if(!e.taxonomy_term_changed){return}mediaLibraryOrganizerGridViewUpdateTaxonomyFilters();mediaLibraryOrganizerGridViewRefresh()})(jQuery)});wp.media.events.on("mlo:grid:edit-attachment:deleted",function(e){mediaLibraryOrganizerGridViewUpdateTaxonomyFilters()});wp.media.events.on("mlo:grid:bulk_select:disabled",function(){mediaLibraryOrganizerGridViewUpdateTaxonomyFilters()});function mediaLibraryOrganizerInitialize(){mediaLibraryOrganizerQueryInitialize();mediaLibraryOrganizerUploaderInitializeEvents();mediaLibraryOrganizerGridViewInitializeTaxonomyFilters();mediaLibraryOrganizerGridViewInitializeOrderByFilter();mediaLibraryOrganizerGridViewInitializeOrderFilter();mediaLibraryOrganizerGridViewAddFiltersToToolbar();mediaLibraryOrganizerGridViewInitializeEditAttachmentListeners();jQuery(document).ready(function(e){if(typeof mediaLibraryOrganizerSelectizeInit!=="undefined"){mediaLibraryOrganizerSelectizeInit()}})}mediaLibraryOrganizerInitialize();